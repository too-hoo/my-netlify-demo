<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>个人资料 - 客服门户</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
    <header><h1>账户设置</h1><a href="/">返回首页</a></header>
    <main>
        <div style="text-align: center; margin-bottom: 2rem;">
            <img id="current-avatar" src="https://via.placeholder.com/100" class="avatar" style="width:100px; height:100px;">
        </div>
        <form id="profile-form">
            <p><label>昵称: <input type="text" id="new-name" required></label></p>
            <p><label>头像图片链接: <input type="url" id="new-avatar" placeholder="https://..."></label></p>
            <button type="submit">保存更新</button>
        </form>
    </main>
    <script>
        netlifyIdentity.init({ locale: 'zh' });
        
        netlifyIdentity.on('init', user => {
            if (!user) window.location.href = "/";
            document.getElementById('new-name').value = user.user_metadata.full_name || "";
            document.getElementById('new-avatar').value = user.user_metadata.avatar_url || "";
            if (user.user_metadata.avatar_url) document.getElementById('current-avatar').src = user.user_metadata.avatar_url;
        });

        document.getElementById('profile-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const user = netlifyIdentity.currentUser();
            try {
                // 更新用户元数据
                await user.update({
                    data: {
                        full_name: document.getElementById('new-name').value,
                        avatar_url: document.getElementById('new-avatar').value
                    }
                });
                alert("更新成功！");
                location.reload();
            } catch (err) { alert("错误: " + err.message); }
        });
    </script>
</body>
</html>